!function(a,e){a.fn.adminpanel=function(n){var l={grid:".admin-grid",draggable:!1,mobile:!1,preserveGrid:!1,onPanel:function(){console.log("callback:","onPanel")},onStart:function(){console.log("callback:","onStart")},onSave:function(){console.log("callback:","onSave")},onDrop:function(){console.log("callback:","onDrop")},onFinish:function(){console.log("callback:","onFinish")}},n=a.extend({},l,n),o=a(this),t=(o.attr("id"),n.grid),s=n.draggable,i=n.mobile,r=n.preserveGrid,c=o.find(".panel"),p="panel-settings_"+location.pathname,d="panel-positions_"+location.pathname,f=localStorage.getItem(p),u=localStorage.getItem(d);a(".panel").on("click",".panel-controls > a",function(e){e.preventDefault(),a("body.ui-drag-active").length||h.controlHandlers.call(this,n)});var h={init:function(e){a(this);if("function"==typeof e.onStart&&e.onStart(),u?h.setPositions():localStorage.setItem(d,h.findPositions()),f||localStorage.setItem(p,h.modifySettings()),a(t).each(function(e,n){a(n).attr("id","grid-"+e)}),r){var n="<div class='panel preserve-grid'></div>";a(t).each(function(e,l){a(l).append(n)})}h.createControls(e),h.createMobileControls(e),h.applySettings(),s===!0&&o.sortable({items:o.find('.panel:not(".sort-disable")'),connectWith:t,cursor:"default",revert:250,handle:".panel-heading",opacity:1,delay:100,tolerance:"pointer",scroll:!0,placeholder:"panel-placeholder",forcePlaceholderSize:!0,forceHelperSize:!0,start:function(e,n){a("body").addClass("ui-drag-active"),n.placeholder.height(n.helper.outerHeight()-4)},beforeStop:function(){"function"==typeof e.onDrop&&e.onDrop()},stop:function(){a("body").removeClass("ui-drag-active")},update:function(){h.toggleLoader(),h.updatePositions(e)}}),"function"==typeof e.onFinish&&e.onFinish()},createMobileControls:function(){var e=c.find(".panel-controls"),n={};a.each(e,function(e,l){var o=a(l),t=a(l).parents(".panel").attr("id"),s=o.width(),i=o.siblings(".panel-title").width(),r=(o.parent(".panel-heading").width(),s+i);n[t]=r}),console.log(n),a.each(n,function(e,n){var l=a("#"+e),o=l.width()-75,t=l.find(".panel-controls");if(i===!0||n>o){l.addClass("mobile-controls");var s={html:!0,placement:"left",content:function(){var e=a(this).clone();return e},template:'<div data-popover-id="'+e+'" class="popover" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'};t.popover(s)}else t.removeClass("mobile-controls")}),a(".mobile-controls .panel-heading > .panel-controls").on("click",function(){a(this).toggleClass("panel-controls-open")})},applySettings:function(){var e=localStorage.getItem(p),n=JSON.parse(e),l="panel-primary panel-success panel-info panel-warning panel-danger panel-alert panel-system panel-dark panel-default";a.each(n,function(e,n){a.each(n,function(e,n){var o=n.id,t=n.title,s=n.collapsed,i=n.hidden,r=n.color,c=a("#"+o);t&&c.children(".panel-heading").find(".panel-title").text(t),1===s&&c.addClass("panel-collapsed").children(".panel-body, .panel-menu, .panel-footer").hide(),r&&c.removeClass(l).addClass(r).attr("data-panel-color",r),1===i&&c.addClass("panel-hidden").hide().remove()})})},createControls:function(){var e='<span class="panel-controls"></span>',n='<a href="#" class="panel-control-title"></a>',l='<a href="#" class="panel-control-color"></a>',o='<a href="#" class="panel-control-collapse"></a>',t='<a href="#" class="panel-control-fullscreen"></a>',s='<a href="#" class="panel-control-remove"></a>',i='<a href="#" class="panel-control-callback"></a>',r='<a href="#" class="panel-control-dockable" data-toggle="popover" data-content="panelDockContent();"></a>',p='<a href="#" class="panel-control-expose"></a>',d='<a href="#" class="panel-control-loader"></a>';c.each(function(c,f){var u=a(f),h=u.children(".panel-heading");a(e).appendTo(h);var g=u.attr("data-panel-title"),v=u.attr("data-panel-color"),m=u.attr("data-panel-collapse"),b=u.attr("data-panel-fullscreen"),y=u.attr("data-panel-remove"),C=u.attr("data-panel-callback"),S=u.attr("data-panel-dockable"),x=u.attr("data-panel-expose"),k=u.attr("data-panel-loader");if(!k){var T=h.find(".panel-controls");a(d).appendTo(T)}if(x){var T=h.find(".panel-controls");a(p).appendTo(T)}if(S){var T=h.find(".panel-controls");a(r).appendTo(T)}if(C){var T=h.find(".panel-controls");a(i).appendTo(T)}if(!y){var T=h.find(".panel-controls");a(s).appendTo(T)}if(!g){var T=h.find(".panel-controls");a(n).appendTo(T)}if(!v){var T=h.find(".panel-controls");a(l).appendTo(T)}if(!m){var T=h.find(".panel-controls");a(o).appendTo(T)}if(!b){var T=h.find(".panel-controls");a(t).appendTo(T)}})},controlHandlers:function(){var l=a(this),t=(l.attr("class"),l.parents(".panel")),i=t.children(".panel-heading"),r=t.find(".panel-title"),c=function(){var a=function(){var a=t.find(".panel-editbox");a.slideToggle("fast",function(){t.toggleClass("panel-editbox-open"),t.hasClass("panel-editbox-open")||(r.text(a.children("input").val()),h.updateSettings(n))})};if(t.find(".panel-editbox").length)a();else{var e='<div class="panel-editbox"><input type="text" class="form-control" value="'+r.text()+'"></div>';i.after(e);var l=t.find(".panel-editbox");l.children("input").on("keyup",function(){r.text(l.children("input").val())}),l.children("input").on("keypress",function(e){13==e.which&&a()}),a()}},p=function(){if(!t.find(".panel-colorbox").length){var e='<div class="panel-colorbox"> <span class="bg-white" data-panel-color="panel-default"></span> <span class="bg-primary" data-panel-color="panel-primary"></span> <span class="bg-info" data-panel-color="panel-info"></span> <span class="bg-success" data-panel-color="panel-success"></span> <span class="bg-warning" data-panel-color="panel-warning"></span> <span class="bg-danger" data-panel-color="panel-danger"></span> <span class="bg-alert" data-panel-color="panel-alert"></span> <span class="bg-system" data-panel-color="panel-system"></span> <span class="bg-dark" data-panel-color="panel-dark"></span> </div>';i.after(e)}var l=t.find(".panel-colorbox");l.on("click","> span",function(){var e=a(this).data("panel-color"),l="panel-primary panel-info panel-success panel-warning panel-danger panel-alert panel-system panel-dark panel-default panel-white";t.removeClass(l).addClass(e).data("panel-color",e),h.updateSettings(n)}),l.slideToggle("fast",function(){t.toggleClass("panel-colorbox-open")})},d=function(){t.toggleClass("panel-collapsed"),t.children(".panel-body, .panel-menu, .panel-footer").slideToggle("fast",function(){h.updateSettings(n)})},f=function(){a("body.panel-fullscreen-active").length?(a("body").removeClass("panel-fullscreen-active"),t.removeClass("panel-fullscreen"),s===!0&&o.sortable("enable")):(a("body").addClass("panel-fullscreen-active"),t.addClass("panel-fullscreen"),s===!0&&o.sortable("disable")),a(".panel-controls").removeClass("panel-controls-open"),a(".popover").popover("hide"),setTimeout(function(){a(e).trigger("resize")},100)},u=function(){PNotify?new PNotify({addclass:"admin-panel-note",animate_speed:"fast",title:"Are you sure?",hide:!1,type:"info",addclass:"mt50",buttons:{closer:!1,sticker:!1},confirm:{confirm:!0,buttons:[{text:"Yup, Do it.",addClass:"btn-sm btn-primary light mt10"},{text:"Cancel",addClass:"btn-sm btn-primary mt10"}]},history:{history:!1}}).get().on("pnotify.confirm",function(){t.addClass("panel-removed").hide(),h.updateSettings(n)}).on("pnotify.cancel",function(){}):bootbox.confirm?bootbox.confirm("Are You Sure?!",function(a){a&&setTimeout(function(){t.addClass("panel-removed").hide(),h.updateSettings(n)},200)}):(t.addClass("panel-removed").hide(),h.updateSettings(n))},g=function(){"function"==typeof n.onPanel&&n.onPanel()},v=function(){};a(this).hasClass("panel-control-collapse")&&d(),a(this).hasClass("panel-control-title")&&c(),a(this).hasClass("panel-control-color")&&p(),a(this).hasClass("panel-control-fullscreen")&&f(),a(this).hasClass("panel-control-remove")&&u(),a(this).hasClass("panel-control-callback")&&g(),a(this).hasClass("panel-control-expose")&&v(),a(this).hasClass("panel-control-dockable")||a(this).hasClass("panel-control-loader")||h.toggleLoader.call(this)},toggleLoader:function(){var e=a(this),n=e.parents(".panel");n.addClass("panel-loader-active"),setTimeout(function(){n.removeClass("panel-loader-active")},650)},modifySettings:function(){var e=[];c.each(function(n,l){var o=a(l),t={},s=(o.attr("id"),o.children(".panel-heading").find(".panel-title").text(),o.hasClass("panel-collapsed")?1:0,o.is(":hidden")?1:0,o.data("panel-color"));t.id=o.attr("id"),t.title=o.children(".panel-heading").find(".panel-title").text(),t.collapsed=o.hasClass("panel-collapsed")?1:0,t.hidden=o.is(":hidden")?1:0,t.color=s?s:null,e.push({panel:t})});var n=JSON.stringify(e);return n},findPositions:function(){var e=o.find(t),n=[];e.each(function(e,l){var o=a(l).find(".panel"),t=[];a(l).attr("id","grid-"+e),o.each(function(e,n){var l=a(n).attr("id");t.push(l)}),n[e]=t});var l=JSON.stringify(n);return l},setPositions:function(){var e=localStorage.getItem(d),n=JSON.parse(e);a(t).each(function(e,l){var o=a(l);a.each(n[e],function(e,n){a("#"+n).appendTo(o)})})},updatePositions:function(a){localStorage.setItem(d,h.findPositions()),"function"==typeof a.onSave&&a.onSave()},updateSettings:function(a){localStorage.setItem(p,h.modifySettings()),"function"==typeof a.onSave&&a.onSave()}};return this.each(function(){h.init.call(o,n)})}}(jQuery,window,document);